---
# main playbook for running all
- name: Create instance(s)
  hosts: localhosts
  connection: local
  gather_facts: no

  vars:
    credentials_file: ./google.json
    machine_type: g1-small
    image: ubuntu-1604-xenial-v20180509
    compute_zone: us-central1-c
    instance_names: ["manager-1"]
    spot: true

  tasks:

   - name: Launch instances
     gce:
         instance_names: "{{ ','.join(instance_names) }}"
         machine_type: "{{ machine_type }}"
         image: "{{ image }}"
         service_account_email: "ansible@{{ project }}.iam.gserviceaccount.com"
         credentials_file: "{{ credentials_file }}"
         project_id: "{{ project }}"
         zone: "{{ compute_zone }}"
         state: "{{ state }}"
         preemptible: "{{ spot }}"
     delegate_to: localhost
     register: gce_result

#   - name: Add created instances to inventory
#     add_host:
#       name: "{{ item.name }}"
#       ansible_host: "{{ item.public_ip }}"
#     with_items: "{{ gce_result.instance_data }}"


